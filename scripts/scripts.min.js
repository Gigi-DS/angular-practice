var blogApp=angular.module("someBlogApp",["ngRoute","someBlogServices","ngAnimate","alertServices"]);blogApp.controller("testCtrl",["$scope","$http",function(e,t){e.main={Name:"Gigi",Address:"Unknown"}}]),blogApp.config(["$routeProvider",function(e){e.when("/",{templateUrl:"app/views/home.html",controller:"homeCtrl"}).when("/articles",{templateUrl:"app/views/articles.html",controller:"articlesCtrl"}).when("/article/:articleId",{templateUrl:"app/views/article.html",controller:"articleCtrl"}).when("/register",{templateUrl:"app/views/register.html",controller:"registerCtrl"}).when("/addarticle",{templateUrl:"app/views/addarticle.html",controller:"addArticleCtrl"}).when("/persons",{templateUrl:"app/views/persons.html",controller:"personsCtrl"}).when("/addcustomer",{templateUrl:"app/views/addcustomer.html",controller:"addCustCtrl"}).when("/editcustomer/:customerId",{templateUrl:"app/views/editcustomer.html",controller:"editCustCtrl"}).when("/partialupdate/:customerId",{templateUrl:"app/views/partialupdate.html",controller:"partialUpdtCtrl"}).otherwise({redirectTo:"app/"})}]),blogApp.controller("addArticleCtrl",["$scope","$http","articles","LS","artID",function(e,t,r,o,n){e.article={id:"",img:"",title:"",short_desc:"",desc:""},e.addArticle=function(t){e.articles=o.getData(),console.log("old articles"+e.articles),e.id=n.setId(),(e.articles.id=e.id)&&(e.id=n.setId()),e.article.id=e.id,e.article.img="3.jpg",e.articles=e.articles.push(t),console.log("new articles"+e.articles),console.log(e.article),o.setData(e.articles)}}]),blogApp.controller("addCustCtrl",["$scope","$log","LS","$window","customerData","alertService",function(e,t,r,o,n,a){e.cust={id:0,name:"",lastname:"",hobby:"",age:""},e.addCust=function(t){n.addCustomer(t).then(function(t){e.cust=t,o.location="#/persons",a.display("Customer successefuly added!","success")},function(e){a.display(e.message,"danger")})},e.redirect=function(){o.location="#/persons"}}]),blogApp.controller("alertCtrl",["$scope","$timeout","alertService",function(e,t,r){function o(){r.subscribe(e,function(){var e=r.getMessage();n(e.text,e.type)})}function n(r,o){e.messageShow=!0,e.message=r,e.type=o,t(function(){e.messageShow=!1},3e3)}e.message="",e.type="success",o()}]),blogApp.controller("articleCtrl",["$scope","$http","$routeParams","articles",function(e,t,r,o){e.article=o.get({articleId:r.articleId})}]),blogApp.controller("articlesCtrl",["$scope","$window","$http","articles","LS",function(e,t,r,o,n){e.orderArticle="-id",e.articles=n.getData("articles-storage"),console.log(e.articles),e.removeArticle=function(t){for(i=e.articles.length-1;i>=0;i--)e.articles[i].id==t&&e.articles.splice(i,1),n.setData(e.articles)}}]),blogApp.controller("editCustCtrl",["$scope","$window","$routeParams","$log","$location","customerData","alertService",function(e,t,r,o,n,a,i){function s(){a.getCustomer(e.customerId).then(function(t){e.customer=t})}e.customerId=r.customerId,e.customer={},s(),e.updateCustomer=function(e){a.updateCustomer(e).then(function(e){n.path("/persons"),i.display("Customer successefuly updated!","success")},function(e){i.display(e.message,"danger")})},e.removeData=function(e){confirm("Sure to DELETE?")&&a.removeItem(e).then(function(e){n.path("/persons")})},e.redirect=function(e,t){confirm("sure cancel editing?")&&n.path("/persons")}}]),blogApp.controller("homeCtrl",["$scope","$http","articles",function(e,t,r){e.articles=r.query()}]),blogApp.controller("partialUpdtCtrl",["$scope","$window","$routeParams","$location","customerData","alertService",function(e,t,r,o,n,a){function i(){s(e.id)}function s(t){n.getCustomer(t).then(function(t){e.customer=t,e.customer.age=new Date(t.age)})}e.id=r.customerId,e.customer={},e.customer.age="",e.today=new Date,i(),e.redirect=function(e,r){t.location=e+r},e.quickSave=function(t){n.customerPatch(t).then(function(t){e.quickEdit=!1,e.customer={},o.path("/persons"),a.display("Edited successfully updated!","success"),e.updatecustomer.$setUntouched()},function(e){a.display(e.message,"danger")})}}]),blogApp.controller("personsCtrl",["$scope","$routeParams","$window","customerData","$log","$location","$filter","$http","alertService",function(e,t,r,o,n,a,s,c,l){function u(){d()}function d(){o.getData(e.search,e.sortKey,e.reverse,e.pageIndex,e.pageSize).then(function(t){for(items=t.items,i=0;i<items.length;i++)items[i]=p(items[i]);e.persons=t.items,e.totalPages=Math.ceil(t.count/e.pageSize),e.totalPagesArr=g(e.totalPages)})["catch"](function(e){r.alert(e.message)})}function p(e){var t={},r=new Date(e.age);t.birthday=angular.copy(e.age);var o=new Date(s("date")(new Date,"yyyy/MM/dd")),n=o-r,a=6e4,i=60*a,c=24*i,l=365*c;return t.birthday=Math.round(n/l),angular.merge({},e,t)}function m(t){null==e.maxPageRightLeft&&(e.maxPageRightLeft=2);var r=[];for(i=1;i<=e.maxPageRightLeft;i++){var o=e.pageIndex-i,n=e.pageIndex+i;o>0&&r.push(o),n<=e.totalPages&&r.push(n)}return r.push(e.pageIndex),r.sort()}function g(e){var t=[];for(i=1;i<=e;i++)t.push(i);return m(t),m(t)}e.persons=[],e.search="",e.sortKey="id",e.reverse=!0,e.pageIndex=1,e.pageSize=5,e.maxPageRightLeft=2,e.totalPages=0,e.removeId=!1,e.refresh=d,e.quickEdit=!1,u(),e.reloadPage=function(){r.location.reload()},e.sort=function(t){e.sortKey!=t?(e.sortKey=t,e.reverse=!1):e.reverse=!e.reverse,d()},e.setPage=function(t){e.pageIndex=t,d()},e.showCustomer=function(t){e.quickEdit=!0;for(var r={},o=0;o<e.persons.length;o++)if(e.persons[o].id==t){r=angular.copy(e.persons[o]);break}return e.customer=r},e.close=function(){e.customer={},e.quickEdit=!1},e.partUpdate=function(e){a.path("/partialupdate/"+e)},e.fullUpdate=function(e){a.path("/editcustomer/"+e)},e.quickSave=function(t){o.customerPatch(t).then(function(t){e.quickEdit=!1,e.customer={},d(),l.display("Edited successfully updated!","success"),e.partupdate.$setUntouched()},function(e){l.display(e.message,"danger")})},e.redirect=function(e,t){r.location=e+t},n.error()}]),blogApp.controller("registerCtrl",["$scope","$http",function(e,t){e.user={}}]);var alertServices=angular.module("alertServices",[]);alertServices.factory("alertService",["$rootScope",function(e){var t="",r="success";return{display:function(o,n){t=o,r=n,e.$emit("alert-message-event")},subscribe:function(t,r){e.$on("alert-message-event",r)},getMessage:function(){return{text:t,type:r}}}}]),blogApp.directive("someBlogArticles",function(){return{restrict:"A",templateUrl:"app/views/directivetmpl/articles.html"}}).directive("someBlogFullArticle",function(){return{restrict:"E",templateUrl:"app/views/directivetmpl/fullarticle.html"}}).directive("emailRequiredValid",function(){return{link:function(e,t,r){t.on("blur",function(){e.regform.email.$error.required&&alert("field is required"),e.regform.email.$invalid&&!e.regform.email.$error.required&&alert("invalid email")})}}}).directive("nameRequired",function(){return{link:function(e,t,r){t.on("blur",function(){e.regform.name.$error.required&&alert("field is required"),e.regform.$error.minlength&&alert("You must enter min. 3 characters")})}}}).directive("passRequired",function(){return{restrict:"A",link:function(e,t,r){t.on("blur",function(){e.regform.password.$error.required&&alert("this field is required"),e.regform.password.$error.minlength&&alert("You must enter min. 6 characters")})}}}).directive("pwCheck",[function(){return{require:"ngModel",link:function(e,t,r){var o="#"+r.pwCheck;t.on("blur",function(){t.val()!==$(o).val()&&alert("Passwords doesn`t match!")})}}}]);var articleServices=angular.module("someBlogServices",["ngResource"]);articleServices.factory("articles",["$resource",function(e){return e("jsondata/:articleId.json",{},{query:{method:"GET",params:{articleId:"articles"},isArray:!0}})}]),articleServices.factory("LS",["$window",function(e){function t(){if(!e.localStorage)throw new Error("local Storage is not set")}return t(),{setData:function(t,r){e.localStorage.setItem(r,JSON.stringify(t))},getData:function(t){return JSON.parse(e.localStorage.getItem(t))},clearData:function(t){e.localStorage.removeItem(t)}}}]),articleServices.factory("artID",["$window",function(e){return{setId:function(){return Math.floor(6e3*Math.random()+1)}}}]),articleServices.factory("customerData",["$http","LS","$q","$filter","$log",function(e,t,r,o,n){function a(e,t){for(var r=0;r<e.length&&e[r].id!=t;r++);return e[r]}function i(){return customers=t.getData("cutomers"),l=customers?r.resolve(customers):e.get(c).then(function(e){return t.setData(e.data,"cutomers"),e.data})["catch"](function(e){throw{status:e.staus,message:e.statusText}}),l["catch"](s),l}function s(e){n.error(e),n.error({status:e.status,message:e.message,source:"customerData"})}var c="jsondata/articles1.json",l=null;return schema={type:"object",properties:{id:{type:"number"},name:{type:"string"},lastname:{type:"string"},hobby:{type:"string"},age:{type:"object"}}},i(),{getData:function(e,t,r,n,a){return l.then(function(i){function s(e){for(var t=[],r=0;r<i.length;r++)(i[r].id==e||i[r].name.toLowerCase()==e.toLowerCase()||i[r].lastname.toLowerCase()==e.toLowerCase()||i[r].hobby.toLowerCase()==e.toLowerCase())&&t.push(i[r]);return t}pages=Math.ceil(i.length/a),e&&(i=s(e));var c=i.length;return t&&(t=r?"+"+t:"-"+t,i=o("orderBy")(i,t)),beginWith=(n-1)*a,i=o("limitTo")(i,a,beginWith),{items:i,count:c}})},getCount:function(){return l.then(function(e){return e.length})},removeItem:function(e){return l.then(function(r){var o,n=r.some(function(t,r){return o=r,t.id==e});return n?(r.splice(o,1),console.log(r),t.setData(r,"cutomers"),!0):!1})},addCustomer:function(e){var o=tv4.validateMultiple(e,schema);return o.valid?l.then(function(r){return r.lastId=0,id=0,angular.forEach(r,function(e,t){e.id>id&&(id=e.id)}),id+=1,e.id=id,r.push(e),t.setData(r,"cutomers"),angular.copy(e)}):r.reject(o.errors[0])},getAll:function(){return l.then(function(e){return angular.copy(e)})},updateCustomer:function(e){var o=tv4.validateMultiple(e,schema);return o.valid?l.then(function(o){return arr=[],angular.forEach(o,function(t,r){t.id!=e.id&&arr.push(t)}),arr.push(e),o=arr,t.setData(o,"cutomers"),l=r.resolve(o),angular.copy(arr)}):r.reject(o.errors[0])},getCustomer:function(e){return l.then(function(t){return customer={},customer=a(t,e),console.log(e),angular.copy(customer)})},customerPatch:function(e){var o=tv4.validateMultiple(e,schema);return o.valid?l.then(function(r){return angular.merge(a(r,e.id),e),t.setData(r,"cutomers"),e}):r.reject(o.errors[0])}}}]);
//# sourceMappingURL=scripts.min.js.map